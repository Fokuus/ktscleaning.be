---
import { render } from "astro:content";
import { formatDate } from "@js/utils";
import BaseLayout from "@layouts/BaseLayout.astro";
import TableOfContents from "@components/TemplateComponents/TableOfContents.astro";
import CTA from "@components/CTA.astro";
import "@styles/markdown.less";

const { project, headings } = Astro.props;
const { title, date, description, image, imageAlt, category } = project.data;
---

<BaseLayout title={title} description={description} preloadedImage={image}>
	<!-- ============================================ -->
	<!--         Project Detail Layout                -->
	<!-- ============================================ -->

	<div class="project-container">
		<!--Main content -->
		<section class="main-content">
			<article class="project-article">
				<!--Article Info-->
				<header class="project-header">
					<h1 class="project-h1">{title}</h1>
					<div class="project-metaGroup">
						<span class="project-category">{category}</span>
						<span aria-hidden="true" class="project-dot"></span>
						<!--Project Date-->
						<span class="project-date">{formatDate(date)}</span>
					</div>
				</header>

				<!--Main Project Image-->
				<picture class="project-mainImage">
					<img src={image} alt={imageAlt} width="795" height="400" decoding="async" />
				</picture>

				<!-- Mobile Table of Contents -->
				<div class="project-sidebar_widget-wrapper cs-hide-on-desktop">
					<TableOfContents headings={headings} levels={3} />
				</div>
				<!--Markdown content-->
				<div id="project-content">
					<slot />
				</div>
			</article>
		</section>
		<!--Side bar-->
		<aside class="project-sidebar">
			<!-- Desktop Table of Contents -->
			<div class="project-sidebar_widget-wrapper cs-hide-on-mobile" id="desktop-toc">
				<TableOfContents headings={headings} levels={3} />
			</div>
			<!-- Project Info -->
			<div class="project-sidebar_widget-wrapper">
				<div class="project-info">
					<h3>Project Details</h3>
					<ul>
						<li><strong>Category:</strong> {category}</li>
						<li><strong>Date:</strong> {formatDate(date)}</li>
					</ul>
				</div>
			</div>
		</aside>
	</div>

	<CTA />

</BaseLayout>

<style lang="less">
/* Mobile - 360px */
@media only screen and (min-width: 0em) {
	.project-container {
		width: 94%;
		max-width: (1120/16em);
		margin: auto;
		padding: clamp(60px, 7vw, 100px) 0;
		display: flex;
		flex-direction: column;
		justify-content: center;
		align-items: center;
		row-gap: (50/16em);
		position: relative;
	}

	.main-content {
		width: 100%;
		display: flex;
		flex-direction: column;
		justify-content: center;
		align-items: center;
		row-gap: (50/16em);
	}

	.project-article {
		width: 100%;
		max-width: (795/16em);
		display: block;

		.project-header {
			margin-block: clamp(30px, 5vw, 50px);
		}
		
		.project-mainImage {
			width: 100%;
			height: clamp(200px, 30vw, 400px);
			margin-bottom: (50/16em);
			border-radius: (8/16em);
			display: block;
			position: relative;
			overflow: hidden;

			img {
				width: 100%;
				height: 100%;
				object-fit: cover;
				position: absolute;
				top: 0;
				left: 0;
			}
		}

		.project-metaGroup {
			display: flex;
			justify-content: flex-start;
			align-items: center;
			gap: (12/16rem);
		}

		.project-category,
		.project-date {
			font-size: (14/16rem);
			line-height: 1.5em;
			color: var(--bodyTextColor);
		}

		.project-category {
			text-transform: uppercase;
			font-weight: 600;
		}

		.project-dot {
			width: 3px;
			height: 3px;
			background-color: var(--primary);
			border-radius: 50%;
			display: block;
		}

		.project-h1 {
			font-size: clamp(20px, 5vw, 39px);
			font-weight: 700;
			line-height: 1.4em;
			max-width: (550/16rem);
			margin: (16/16rem) 0;
			color: var(--headerColor);
		}

		#project-content {
			margin-top: (16/16em);
			padding-top: (25/16em);
			border-top: 1px solid #a2a0a0;
		}
	}

	.project-sidebar {
		width: 100%;
		max-width: (300/16em);

		.project-info {
			padding: (24/16em);
			border-radius: (8/16em);
			background-color: var(--primaryLight);
			margin-bottom: (24/16em);

			h3 {
				font-size: (18/16em);
				margin-bottom: (16/16em);
				color: var(--headerColor);
			}

			ul {
				list-style: none;
				padding: 0;
				margin: 0;

				li {
					margin-bottom: (8/16em);
					font-size: (14/16em);
					color: var(--bodyTextColor);
				}
			}
		}
	}
}

/* Tablet - 1024px */
@media only screen and (min-width: 64em) {
	.project-container{
		flex-direction: row;
		align-items: flex-start;
		column-gap: (48/16em);
	}
}

/* Dark Mode */
@media only screen and (min-width: 0em) {
	body.dark-mode {
		.project-article {
			.project-h1,
			.project-category,
			.project-date {
				color: #f7f7f7;
			}
		}

		.project-sidebar {
			.project-info {
				background-color: rgba(255, 255, 255, 0.05);

				h3 {
					color: #f7f7f7;
				}

				li {
					color: #f7f7f7;
				}
			}
		}
	}
}
</style>
