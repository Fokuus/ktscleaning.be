---
import "@styles/root.less";
import "@styles/reviews.less";
import "@styles/services.less";
import BaseLayout from "@layouts/BaseLayout.astro";
import Diensten from "@components/Diensten.astro";
import WhyChooseUs from "@components/WhyChooseUs.astro";
import SideBySide from "@components/SideBySide.astro";
import FAQ from "@components/FAQ.astro";
import Button from "@components/Button.astro";

import { getCollection } from "astro:content";
import { getImage } from "astro:assets";

// Get blog posts for the gallery
const posts = await getCollection("blog");
// Sort posts by date (newest first)
posts.sort((a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf());

// Process blog post images
const processedPosts = await Promise.all(posts.map(async (post) => {
  const imageData = post.data.image;
  
  // Handle string paths
  if (typeof imageData === 'string') {
    // For relative paths, we'd need a different approach - using a fallback for now
    return {
      ...post,
      processedImage: imageData
    };
  }
  
  // Handle image objects
  if (imageData && typeof imageData === 'object' && 'src' in imageData) {
    return {
      ...post,
      processedImage: imageData.src
    };
  }
  
  // Fallback
  return {
    ...post,
    processedImage: '/assets/images/blog/blog-cover.jpg'
  };
}));

// Optimize our landing image and pass it as props to the BaseLayout (for preloading) and Landing (for rendering)
import landingImage from "@assets/images/landing.jpg" // <-- THE PATH TO THE ASSET YOU WANT TO PRELOAD - The asset must live in src
import Hero from "@components/Hero.astro";
const optimizedImage = await getImage({src: landingImage, format: 'avif'})
---

<BaseLayout
  title="Pixel Perfect Websites"
  description="Meta description for the page"
  preloadedImage = {optimizedImage}
>

<Hero />

<Diensten />

<WhyChooseUs />

<SideBySide />

<FAQ />

</BaseLayout>