---
// PortfolioMasonry.astro - A masonry grid portfolio component with smooth hover effects
import "@styles/portfolio.less";
import "@styles/projects.less";
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import placeholderLogo from "../assets/images/projects/placeholder-logo.svg";

// Get all portfolio items from the collection
let portfolioItems = [];
try {
  portfolioItems = await getCollection("projects"); // Changed from "portfolio" to "projects" to match the collection name
  console.log(`Found ${portfolioItems.length} portfolio items`);
} catch (error) {
  console.error('Error loading portfolio items:', error);
}

// Placeholder projects when no items are found in the collection
const placeholderItems = [
  {
    id: "placeholder-project",
    data: {
      title: "Placeholder Project",
      category: "Web Development",
      image: "https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=800&q=80",
      imageAlt: "Placeholder Project",
      featured: true,
      date: new Date(),
      logo: "" // Add empty logo property to fix TypeScript errors
    }
  }
];

// Use real items if available, otherwise use placeholders
const allItems = portfolioItems.length > 0 ? portfolioItems : placeholderItems;

// Sort by date and get featured items first, then limit to 4 items for homepage
const sortedItems = allItems
  .sort((a, b) => {
    // First sort by featured status
    if (a.data.featured && !b.data.featured) return -1;
    if (!a.data.featured && b.data.featured) return 1;
    
    // Then sort by date (newest first)
    return new Date(b.data.date).getTime() - new Date(a.data.date).getTime();
  })
  .slice(0, 4); // Limit to 4 items for homepage

---

<section id="portfolio" class="portfolio-section">
  <div class="portfolio-container">
    <div class="portfolio-header wow animate__fadeInUp">
      <p class="cs-topper">Ons Werk</p>
      <h2 class="cs-title">Uitgelichte Projecten</h2>
      <div class="portfolio-divider"></div>
    </div>

    <div class="projects-grid homepage-grid">
      {sortedItems.map((item, index) => {
        // For real portfolio items, use the ID as slug
        // For placeholder items, create a slug from the title
        const slug = item.id ? 
          item.id.replace(/\.md$/, '') : 
          item.data.title.toLowerCase().replace(/\s+/g, '-');
        
        return (
          <a href={`/portfolio/${slug}`} class={`project-card wow animate__fadeInUp`} data-wow-delay={`${0.1 + index * 0.1}s`}>
            <div class="project-card-inner">
              {/* Background image with zoom effect */}
              <div class="project-background">
                {typeof item.data.image === 'string' ? (
                  <img 
                    src={item.data.image} 
                    alt={item.data.imageAlt || item.data.title}
                    class="project-bg-image"
                  />
                ) : (
                  <Image 
                    src={item.data.image} 
                    alt={item.data.imageAlt || item.data.title}
                    class="project-bg-image"
                    width={800}
                    height={800}
                  />
                )}
              </div>
              
              {/* Overlay with gradient */}
              <div class="project-overlay"></div>
              
              {/* Centered logo */}
              <div class="project-logo-container">
                {item.data.logo ? (
                  <img 
                    src={item.data.logo} 
                    alt={`${item.data.title} logo`}
                    class="project-logo"
                    width="120"
                    height="120"
                  />
                ) : (
                  <Image 
                    src={placeholderLogo} 
                    alt={`${item.data.title} logo`}
                    class="project-logo"
                    width="120"
                    height="120"
                  />
                )}
              </div>
              
              {/* Bottom info bar */}
              <div class="project-info">
                <div class="project-title">{item.data.title}</div>
                <div class="project-category">{item.data.category}</div>
              </div>
            </div>
          </a>
        );
      })}
    </div>
    
    <div class="portfolio-cta wow animate__fadeInUp" data-wow-delay="0.6s">
      <a href="/portfolio" class="portfolio-button">Bekijk alle projecten</a>
    </div>
  </div>
</section>

